<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>
		<style>
			#reader {
				margin: 0px;
				height: 100vh;
				width: 100vw;
				overflow: hidden;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			/* #prev {
				height: 100%;
				width: 25%;
				position: absolute;
				top: 0;
				bottom: 0;
				left: 0;
				background-color: red;
			}
			#next {
				height: 100%;
				width: 25%;
				position: absolute;
				top: 0;
				bottom: 0;
				right: 0;
				background-color: red;
			} */
		</style>
	</head>
	<body>
		<div id="reader"></div>
		<!-- <div id="prev"></div> -->
		<!-- <div id="next"></div> -->
	</body>
	<script>
		// display book and set up communication
		// console.log(window.BOOK_PATH);
		let book = ePub(window.BOOK_PATH);
		window.rendition = book.renderTo(document.getElementById('reader'), {
			width: '85%',
			height: '90%'
		});
		window.rendition.on('started', () => {
			window.rendition.display(window.BOOK_LOCATION);
			window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'key', key: book.key() }));
		});
		book.loaded.cover.then((url) => {
			window.ReactNativeWebView.postMessage(JSON.stringify({ type: 'cover', cover: url }));
		});
		book.loaded.metadata.then((metadata) => {
			window.ReactNativeWebView.postMessage(
				JSON.stringify({ type: 'metadata', title: metadata.title, author: metadata.creator })
			);
		});
		window.rendition.on('relocated', (e) => {
			window.ReactNativeWebView.postMessage(
				JSON.stringify({ type: 'loc', key: book.key(), cfi: e.start.cfi })
			);
		});
		// rendition.on('selected', () => {
		// 	let selected =
		// 		rendition.manager && rendition.manager.getContents().length > 0
		// 			? rendition.manager
		// 					.getContents()[0]
		// 					.window.getSelection()
		// 					.toString()
		// 					.trim()
		// 			: '';
		// });

		// event listeners
		// document.getElementById('next').addEventListener('click', rendition.next);
		// document.getElementById('prev').addEventListener('click', rendition.prev);
	</script>
</html>
